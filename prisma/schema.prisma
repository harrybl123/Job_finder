// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id               String   @id // Clerk user ID (e.g., user_xxx)
  email            String?  @unique
  name             String?
  parsedCV         String?  // JSON string of structured CV data from AI parsing
  currentLevel     Int?     // Experience level (1-8, maps to ExperienceLevel enum)
  yearsExperience  Int?     // Total years of professional experience
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  recommendations CareerRecommendation[]
  savedJobs       SavedJob[]
  chatMessages    ChatMessage[]
  careerAnalyses  CareerAnalysis[]
}

model CareerRecommendation {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  paths     String   // JSON string of 3 career paths from AI
  reasoning String   // Why these paths were recommended
  
  createdAt DateTime @default(now())
  
  @@index([userId])
}

model SavedJob {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  jobData   String   // JSON string of full job object
  status    String   @default("saved") // "saved" | "applied" | "interview" | "rejected"
  notes     String?
  
  savedAt   DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([userId])
  @@index([status])
}

model CareerAnalysis {
  id               String   @id @default(cuid())
  userId           String
  user             User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  jobTitle         String
  intelligentQuery String   // Rich search query generated by Claude
  reasoning        String   // Why this query fits the user
  keyStrengths     String?  // JSON string: transferable skills
  potentialGaps    String?  // JSON string: areas to develop
  createdAt        DateTime @default(now())
  expiresAt        DateTime // Recalculate after 30 days or CV update
  
  @@unique([userId, jobTitle])
  @@index([userId])
  @@index([expiresAt])
}

model ChatMessage {
  id        String   @id @default(cuid())
  userId    String
  role      String   // "user" | "assistant"
  content   String
  createdAt DateTime @default(now())
  
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@index([userId])
  @@index([createdAt])
}
